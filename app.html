<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agri-Vani App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* --- CORE STYLES --- */
        :root {
            --primary: #16a34a;
            --dark: #1c1917;
            --light: #f5f5f4;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #e7e5e4; /* Background for desktop view */
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
        }

        /* Mobile Container (Phone View on Desktop, Full on Mobile) */
        #app-root {
            width: 100%;
            max-width: 450px; /* Limits width on desktop */
            height: 100%;
            background-color: #fcfcfc;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        /* Hide Scrollbars but keep functionality */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- ANIMATIONS --- */
        @keyframes scan-laser {
            0% { top: 5%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 95%; opacity: 0; }
        }
        .scanner-line {
            position: absolute;
            left: 10%;
            width: 80%;
            height: 2px;
            background: #ef4444;
            box-shadow: 0 0 15px #ef4444;
            animation: scan-laser 2s ease-in-out infinite;
            z-index: 20;
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(22, 163, 74, 0); }
            100% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0); }
        }
        .mic-active { animation: pulse-ring 1.5s infinite; transform: scale(1.05); }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-enter { animation: fade-in-up 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }

        /* Screen Management */
        .screen { display: none; height: 100%; flex-direction: column; background: #fafaf9; }
        .screen.active { display: flex; }

        /* Glassmorphism Elements */
        .glass-nav {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        
        .glass-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            position: sticky;
            top: 0;
            z-index: 40;
        }

        /* Camera Elements */
        #camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0; left: 0;
            z-index: 0;
            background: #222; /* Fallback */
        }
    </style>
</head>
<body>

    <div id="app-root">
        
        <!-- HEADER -->
        <header class="glass-header px-5 py-4 flex justify-between items-center shadow-sm">
            <div class="flex items-center gap-2.5">
                <div class="w-9 h-9 bg-gradient-to-br from-green-600 to-green-700 rounded-xl flex items-center justify-center text-white shadow-green-200 shadow-lg">
                    <i class="ph ph-plant-fill text-lg"></i>
                </div>
                <div>
                    <h1 class="font-bold text-gray-900 text-lg leading-tight tracking-tight">Agri-Vani</h1>
                    <p class="text-[10px] font-medium text-green-600 uppercase tracking-wider">Assistant</p>
                </div>
            </div>
            <button onclick="toggleLang()" id="lang-btn" class="text-xs font-bold bg-white text-gray-700 px-3 py-1.5 rounded-full border border-gray-200 shadow-sm active:bg-gray-50 transition">
                EN
            </button>
        </header>

        <!-- CONTENT -->
        <main class="flex-1 relative overflow-hidden">

            <!-- 1. HOME SCREEN -->
            <div id="screen-home" class="screen active overflow-y-auto no-scrollbar pb-24">
                
                <!-- Weather Widget -->
                <div class="px-5 pt-6 pb-2">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-3xl p-5 text-white shadow-lg shadow-blue-200 relative overflow-hidden">
                        <div class="relative z-10 flex justify-between items-center">
                            <div>
                                <span class="text-blue-100 text-xs font-medium uppercase tracking-wider">Guwahati, Assam</span>
                                <div class="text-4xl font-bold mt-1">28¬∞<span class="text-2xl text-blue-200">C</span></div>
                                <div class="text-sm font-medium text-blue-50 mt-1">Haze ‚Ä¢ H:32¬∞ L:24¬∞</div>
                            </div>
                            <i class="ph ph-cloud-sun text-6xl text-blue-200 opacity-90"></i>
                        </div>
                        <!-- Decor -->
                        <div class="absolute -bottom-4 -right-4 w-24 h-24 bg-white opacity-10 rounded-full blur-xl"></div>
                    </div>
                </div>

                <!-- Voice Assistant -->
                <div class="px-5 py-6">
                    <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-gray-100 text-center relative overflow-hidden">
                        <p class="text-gray-400 text-sm font-medium mb-6" id="voice-status">Tap microphone to speak...</p>
                        
                        <div class="flex justify-center relative z-10">
                            <button id="mic-btn" onclick="toggleVoice()" class="w-24 h-24 bg-gradient-to-b from-green-500 to-green-600 rounded-full text-white text-4xl shadow-xl shadow-green-100 flex items-center justify-center transition-transform active:scale-95">
                                <i class="ph ph-microphone-fill"></i>
                            </button>
                        </div>
                        <p class="mt-6 text-gray-800 font-semibold text-lg">"How is my soil?"</p>
                        
                        <!-- Decorative background rings -->
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 border border-green-50 rounded-full"></div>
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 border border-gray-50 rounded-full"></div>
                    </div>
                </div>

                <!-- Tools Grid -->
                <div class="px-5">
                    <h3 class="text-gray-900 font-bold text-lg mb-4">Quick Tools</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="nav('screen-camera', 'pesticide')" class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-transform hover:shadow-md">
                            <div class="w-12 h-12 bg-red-50 text-red-500 rounded-full flex items-center justify-center text-2xl"><i class="ph ph-warning-octagon"></i></div>
                            <span class="font-semibold text-gray-700 text-sm">Pesticide Scan</span>
                        </button>
                        <button onclick="nav('screen-camera', 'disease')" class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-transform hover:shadow-md">
                            <div class="w-12 h-12 bg-emerald-50 text-emerald-600 rounded-full flex items-center justify-center text-2xl"><i class="ph ph-plant"></i></div>
                            <span class="font-semibold text-gray-700 text-sm">Plant Doctor</span>
                        </button>
                        <button onclick="nav('screen-soil')" class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-transform hover:shadow-md">
                            <div class="w-12 h-12 bg-orange-50 text-orange-500 rounded-full flex items-center justify-center text-2xl"><i class="ph ph-thermometer-simple"></i></div>
                            <span class="font-semibold text-gray-700 text-sm">Soil Lab</span>
                        </button>
                        <button onclick="nav('screen-weather')" class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center gap-3 active:scale-95 transition-transform hover:shadow-md">
                            <div class="w-12 h-12 bg-sky-50 text-sky-500 rounded-full flex items-center justify-center text-2xl"><i class="ph ph-umbrella"></i></div>
                            <span class="font-semibold text-gray-700 text-sm">Advisory</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 2. CAMERA SCREEN -->
            <div id="screen-camera" class="screen bg-black">
                <video id="camera-feed" autoplay playsinline muted></video>
                
                <div class="absolute inset-0 flex flex-col justify-between p-6 z-10">
                    <!-- Top Bar -->
                    <div class="flex justify-between items-start">
                        <button onclick="nav('screen-home')" class="w-10 h-10 bg-black/40 backdrop-blur text-white rounded-full flex items-center justify-center active:bg-black/60">
                            <i class="ph ph-x text-lg"></i>
                        </button>
                        <div class="bg-black/50 backdrop-blur px-3 py-1.5 rounded-lg text-white text-xs font-bold uppercase tracking-wider flex items-center gap-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                            <span id="cam-mode">AI Vision</span>
                        </div>
                    </div>

                    <!-- Reticle -->
                    <div class="flex-1 flex items-center justify-center">
                        <div class="w-72 h-72 border-2 border-white/30 rounded-3xl relative">
                            <!-- Corners -->
                            <div class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-white rounded-tl-lg"></div>
                            <div class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-white rounded-tr-lg"></div>
                            <div class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-white rounded-bl-lg"></div>
                            <div class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-white rounded-br-lg"></div>
                            
                            <!-- Scanner Line -->
                            <div class="scanner-line"></div>
                            
                            <p class="absolute -bottom-8 w-full text-center text-white/80 text-sm font-medium">Align object in frame</p>
                        </div>
                    </div>

                    <!-- Result Card (Hidden Initially) -->
                    <div id="scan-result" class="absolute bottom-24 left-4 right-4 bg-white rounded-2xl p-4 shadow-2xl transform translate-y-[150%] transition-transform duration-300 flex items-center gap-4">
                        <div id="res-icon-bg" class="w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-gray-100">
                            <span id="res-icon">ü§î</span>
                        </div>
                        <div>
                            <h3 id="res-title" class="font-bold text-gray-900 text-lg">Processing...</h3>
                            <p id="res-desc" class="text-sm text-gray-500">AI is analyzing the image</p>
                        </div>
                    </div>

                    <!-- Capture Button -->
                    <div class="flex justify-center pb-4">
                        <button onclick="analyzeImage()" class="w-20 h-20 bg-white rounded-full border-4 border-gray-300 flex items-center justify-center shadow-lg active:scale-90 transition-transform">
                            <div class="w-16 h-16 bg-white rounded-full border-2 border-black/10"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 3. SOIL SCREEN -->
            <div id="screen-soil" class="screen bg-gray-50">
                <!-- Header -->
                <div class="bg-white px-5 py-4 border-b border-gray-100 flex items-center gap-3 sticky top-0 z-20">
                    <button onclick="nav('screen-home')" class="text-gray-500"><i class="ph ph-arrow-left text-xl"></i></button>
                    <h2 class="font-bold text-lg text-gray-900">Soil Laboratory</h2>
                </div>

                <div class="p-5 overflow-y-auto pb-24">
                    <!-- Connect Card -->
                    <div id="connect-card" class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 text-white text-center shadow-xl mb-6">
                        <div class="w-16 h-16 bg-white/10 rounded-full mx-auto flex items-center justify-center mb-4 backdrop-blur">
                            <i class="ph ph-broadcast text-3xl" id="bt-icon"></i>
                        </div>
                        <h3 class="font-bold text-xl mb-1" id="bt-status">No Device</h3>
                        <p class="text-gray-400 text-sm mb-6">Power on your Village Stick</p>
                        <button onclick="connectBluetooth()" id="bt-btn" class="w-full bg-green-500 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-green-900/20 active:bg-green-600 transition">
                            Pair Device
                        </button>
                    </div>

                    <!-- Data Grid (Initially Hidden) -->
                    <div id="soil-data" class="hidden animate-enter">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-800">Live Readings</h3>
                            <span class="text-xs text-green-600 bg-green-50 px-2 py-1 rounded-md font-medium">‚óè Online</span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <!-- Moisture -->
                            <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="p-2 bg-blue-50 text-blue-500 rounded-lg"><i class="ph ph-drop-half text-xl"></i></div>
                                    <span class="text-xs font-bold text-gray-400">H2O</span>
                                </div>
                                <div class="text-2xl font-bold text-gray-900">65<span class="text-sm text-gray-400">%</span></div>
                                <div class="text-xs text-green-600 font-medium mt-1">Optimal</div>
                            </div>

                            <!-- Nitrogen -->
                            <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="p-2 bg-green-50 text-green-500 rounded-lg"><i class="ph ph-leaf text-xl"></i></div>
                                    <span class="text-xs font-bold text-gray-400">N</span>
                                </div>
                                <div class="text-2xl font-bold text-gray-900">52<span class="text-sm text-gray-400">mg</span></div>
                                <div class="text-xs text-gray-500 mt-1">Standard</div>
                            </div>

                            <!-- Phosphorus -->
                            <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="p-2 bg-orange-50 text-orange-500 rounded-lg"><i class="ph ph-fire text-xl"></i></div>
                                    <span class="text-xs font-bold text-gray-400">P</span>
                                </div>
                                <div class="text-2xl font-bold text-gray-900">32<span class="text-sm text-gray-400">mg</span></div>
                                <div class="text-xs text-yellow-600 font-medium mt-1">Low</div>
                            </div>

                            <!-- Potassium -->
                            <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="p-2 bg-purple-50 text-purple-500 rounded-lg"><i class="ph ph-lightning text-xl"></i></div>
                                    <span class="text-xs font-bold text-gray-400">K</span>
                                </div>
                                <div class="text-2xl font-bold text-gray-900">40<span class="text-sm text-gray-400">mg</span></div>
                                <div class="text-xs text-gray-500 mt-1">Standard</div>
                            </div>
                        </div>

                        <!-- AI Insight -->
                        <div class="mt-6 bg-yellow-50 p-5 rounded-2xl border border-yellow-100 flex gap-4 items-start">
                            <i class="ph ph-lightbulb text-yellow-600 text-2xl shrink-0"></i>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">Action Required</h4>
                                <p class="text-sm text-gray-700 mt-1 leading-relaxed">Phosphorus levels are slightly low. Consider adding organic bone meal before sowing.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. WEATHER SCREEN -->
            <div id="screen-weather" class="screen bg-white">
                <div class="px-5 py-4 flex items-center gap-3">
                    <button onclick="nav('screen-home')" class="text-gray-500"><i class="ph ph-arrow-left text-xl"></i></button>
                    <h2 class="font-bold text-lg text-gray-900">Forecast</h2>
                </div>

                <div class="p-5">
                    <div class="bg-blue-600 rounded-3xl p-6 text-white shadow-xl shadow-blue-200 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-5xl font-bold">28¬∞</h2>
                                <p class="font-medium opacity-90 mt-1">Heavy Rain</p>
                            </div>
                            <div class="text-right">
                                <i class="ph ph-cloud-rain text-6xl"></i>
                            </div>
                        </div>
                        <div class="flex justify-between border-t border-white/20 pt-4">
                            <div class="text-center">
                                <p class="text-xs opacity-70 mb-1">Humidity</p>
                                <p class="font-bold">82%</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs opacity-70 mb-1">Wind</p>
                                <p class="font-bold">12 km/h</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs opacity-70 mb-1">UV Index</p>
                                <p class="font-bold">Low</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="font-bold text-gray-900 mb-4">Advisory</h3>
                    <div class="space-y-3">
                        <div class="bg-red-50 p-4 rounded-2xl border border-red-100 flex gap-4 items-center">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center text-red-500 shrink-0">
                                <i class="ph ph-warning-octagon text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">Flash Flood Warning</h4>
                                <p class="text-xs text-gray-500">Heavy rain expected (3hrs). Secure equipment.</p>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 flex gap-4 items-center">
                            <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-500 shadow-sm shrink-0">
                                <i class="ph ph-drop text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">Irrigation</h4>
                                <p class="text-xs text-gray-500">Soil moisture is high. Do not water today.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- BOTTOM NAV (Glass) -->
        <nav class="glass-nav h-[70px] flex justify-around items-center px-2 pb-2 absolute bottom-0 w-full z-50">
            <button onclick="nav('screen-home')" class="nav-item active flex flex-col items-center gap-1 p-2 text-green-600 transition">
                <i class="ph ph-house-fill text-2xl"></i>
                <span class="text-[10px] font-bold">Home</span>
            </button>
            <button onclick="nav('screen-camera', 'disease')" class="nav-item flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-gray-600 transition">
                <i class="ph ph-scan text-2xl"></i>
                <span class="text-[10px] font-medium">Scan</span>
            </button>
            <button onclick="nav('screen-soil')" class="nav-item flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-gray-600 transition">
                <i class="ph ph-sliders-horizontal text-2xl"></i>
                <span class="text-[10px] font-medium">Data</span>
            </button>
        </nav>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // State
        let currentLang = 'en';
        let currentMode = '';
        let recognition;

        // --- Navigation ---
        function nav(screenId, mode = null) {
            // Hide all
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            // Handle Tab Styling
            document.querySelectorAll('.nav-item').forEach(b => {
                b.classList.remove('text-green-600');
                b.classList.add('text-gray-400');
            });
            
            // Logic for specific screens
            if (screenId === 'screen-home') {
                document.querySelectorAll('.nav-item')[0].classList.add('text-green-600');
                document.querySelectorAll('.nav-item')[0].classList.remove('text-gray-400');
                stopCamera();
            } else if (screenId === 'screen-camera') {
                document.querySelectorAll('.nav-item')[1].classList.add('text-green-600');
                document.querySelectorAll('.nav-item')[1].classList.remove('text-gray-400');
                startCamera();
                currentMode = mode;
                document.getElementById('cam-mode').innerText = mode === 'pesticide' ? 'Toxicity Scan' : 'Plant Doctor';
                resetScanResult();
            } else if (screenId === 'screen-soil') {
                document.querySelectorAll('.nav-item')[2].classList.add('text-green-600');
                document.querySelectorAll('.nav-item')[2].classList.remove('text-gray-400');
                stopCamera();
            } else {
                stopCamera();
            }
        }

        // --- Voice AI ---
        function toggleVoice() {
            const btn = document.getElementById('mic-btn');
            const status = document.getElementById('voice-status');

            if (!('webkitSpeechRecognition' in window)) {
                status.innerText = "Voice API not supported.";
                return;
            }

            if (!recognition) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = currentLang === 'hi' ? 'hi-IN' : 'en-US';
                recognition.continuous = false;
                
                recognition.onstart = () => {
                    btn.classList.add('mic-active');
                    status.innerText = "Listening...";
                    status.className = "text-green-600 font-bold text-sm mb-6 animate-pulse";
                };
                
                recognition.onend = () => {
                    btn.classList.remove('mic-active');
                    status.innerText = "Processing...";
                    status.className = "text-gray-400 text-sm font-medium mb-6";
                };

                recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript.toLowerCase();
                    status.innerText = `"${text}"`;
                    setTimeout(() => processVoiceCommand(text), 1000);
                };
            }
            recognition.start();
        }

        function processVoiceCommand(text) {
            if (text.includes('disease') || text.includes('plant') || text.includes('check')) {
                speak("Opening Plant Doctor");
                nav('screen-camera', 'disease');
            } else if (text.includes('soil') || text.includes('test')) {
                speak("Opening Soil Laboratory");
                nav('screen-soil');
            } else if (text.includes('weather') || text.includes('rain')) {
                speak("Checking Local Forecast");
                nav('screen-weather');
            } else {
                speak("Sorry, I didn't catch that.");
            }
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Better Voice Selection
            const voices = window.speechSynthesis.getVoices();
            const preferredVoice = voices.find(v => v.lang.includes(currentLang === 'hi' ? 'hi' : 'en') && v.name.includes('Google'));
            if(preferredVoice) utterance.voice = preferredVoice;

            utterance.lang = currentLang === 'hi' ? 'hi-IN' : 'en-US';
            window.speechSynthesis.speak(utterance);
        }

        function toggleLang() {
            currentLang = currentLang === 'en' ? 'hi' : 'en';
            document.getElementById('lang-btn').innerText = currentLang.toUpperCase();
            speak(currentLang === 'en' ? "Language English" : "‡§≠‡§æ‡§∑‡§æ ‡§π‡§ø‡§Ç‡§¶‡•Ä");
        }

        // --- Camera Logic ---
        let stream;
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                document.getElementById('camera-feed').srcObject = stream;
            } catch (e) {
                console.log("Cam error", e);
                document.getElementById('camera-feed').style.background = "#222"; 
            }
        }

        function stopCamera() {
            if (stream) stream.getTracks().forEach(t => t.stop());
        }

        function analyzeImage() {
            const resultBox = document.getElementById('scan-result');
            const title = document.getElementById('res-title');
            const desc = document.getElementById('res-desc');
            const iconBg = document.getElementById('res-icon-bg');
            const icon = document.getElementById('res-icon');

            // Simulate Analysis
            title.innerText = "Analyzing...";
            desc.innerText = "Edge AI processing...";
            resultBox.classList.remove('translate-y-[150%]');

            setTimeout(() => {
                if (currentMode === 'pesticide') {
                    icon.innerText = "üíÄ";
                    iconBg.className = "w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-red-100";
                    title.innerText = "High Toxicity";
                    title.className = "font-bold text-red-600 text-lg";
                    desc.innerText = "Chlorpyrifos detected. Harmful to bees.";
                    speak("Warning. High toxicity detected. Do not use.");
                } else {
                    icon.innerText = "üçÇ";
                    iconBg.className = "w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-orange-100";
                    title.innerText = "Rice Blast";
                    title.className = "font-bold text-orange-600 text-lg";
                    desc.innerText = "Fungal infection. Use Neem Oil.";
                    speak("Rice blast detected. Apply Neem oil treatment.");
                }
            }, 1500);
        }

        function resetScanResult() {
            document.getElementById('scan-result').classList.add('translate-y-[150%]');
        }

        // --- IoT Logic ---
        function connectBluetooth() {
            const btn = document.getElementById('bt-btn');
            const status = document.getElementById('bt-status');
            const icon = document.getElementById('bt-icon');
            
            btn.innerText = "Scanning...";
            btn.classList.add("opacity-75");
            
            setTimeout(() => {
                btn.classList.add("hidden");
                status.innerText = "Connected";
                status.className = "font-bold text-xl mb-1 text-green-400";
                icon.className = "ph ph-bluetooth-connected text-3xl text-green-400";
                document.getElementById('connect-card').className = "bg-gray-900 rounded-2xl p-6 text-white text-center shadow-xl mb-6 border border-green-900";
                
                document.getElementById('soil-data').classList.remove('hidden');
                speak("Village Stick connected. Receiving data.");
            }, 2000);
        }
    </script>
</body>
</html>